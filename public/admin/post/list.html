<!DOCTYPE html>
<html lang="{{ML_TRANS_LANG}}">
    <head>
        <meta charset="UTF-8">
        <title>{{ML_BLOG_NAME}} - Admin</title>
        <style>
            * {
                box-sizing: border-box;
            }
            html, body {
                height: 100%;
            }
            body {
                background-color: #121212;
                color: #e0e0e0;
                font-family: Arial, sans-serif;
                margin: 0;
                padding: 0;
                overflow-x: hidden;
                height: 100%;
            }
            #page-container {
                min-height: 100vh;
                display: flex;
                flex-direction: column;
            }
            header {
                top: 0;
                bottom: auto;
                display: flex;
                justify-content: space-between;
                align-items: center;
                background-color: rgba(40, 40, 40, 0.7);
                backdrop-filter: blur(8px);
                -webkit-backdrop-filter: blur(8px);
                color: white;
                padding: 10px 20px;
                position: fixed;
                width: 100%;
                left: 0;
                z-index: 10;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
                overflow: hidden;
            }
            footer {
                display: block;
                width: 100%;
                text-align: center;
                background-color: #1f1f1f;
                color: white;
                padding: 10px;
                border: none;
            }
            main {
                padding: 20px 20px 60px;
                margin-top: 50px;
                margin-bottom: 40px;
                flex: 1;
            }
            .post-card {
                background-color: #1e1e1e;
                color: #e0e0e0;
                border-radius: 25px;
                padding: 15px;
                margin-bottom: 10px;
                cursor: default;
                border: 1px solid #2a2a2a;
                font-size: 14px;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            .post-card .info {
                flex: 1;
            }
            .post-card .actions {
                display: flex;
                gap: 10px;
            }
            .post-card button {
                border-radius: 25px;
                padding: 10px 15px;
                border: none;
                cursor: pointer;
                font-size: 14px;
                font-weight: bold;
            }
            .post-card .edit {
                background-color: dodgerblue;
                color: white;
            }
            .post-card .delete {
                background-color: crimson;
                color: white;
            }
            #category-filter {
                border-radius: 25px;
                padding: 5px 10px;
                font-size: 16px;
                background-color: #2a2a2a;
                color: white;
                border: none;
                max-width: 40vw;
                cursor: pointer;
                transition: background-color 0.2s, color 0.2s;
            }
            #category-filter:hover {
                background-color: rgba(255, 255, 255, 0.1);
            }
            #logo {
                font-weight: bold;
                text-decoration: none;
                color: inherit;
                padding: 6px 12px;
                border-radius: 25px;
                transition: background-color 0.2s;
                cursor: pointer;
            }
            #logo:hover {
                background-color: rgba(255, 255, 255, 0.1);
            }
            #post-list a {
                display: block;
                color: inherit;
                text-decoration: none;
            }
        </style>
    </head>
    <body>
        <div id="page-container">
            <header style="display: flex; justify-content: space-between; align-items: center;">
                <div style="display: flex; align-items: center; gap: 4px;">
                    <a href="/" id="logo">{{ML_BLOG_NAME}}</a>
                    <a href="/admin" id="logo" style="color: dodgerblue;">Admin</a>
                </div>
                <div id="category-wrapper">
                    <select id="category-filter">
                        <option value="all">All Categories</option>
                    </select>
                </div>
            </header>

            <main>
                <div id="post-list"></div>
            </main>

            <footer></footer>
        </div>

        <script src="/admin/auth.js"></script>
        <script>
            function loadPosts() {
                fetch('/api/user/post/list/1000')
                    .then(res => res.json())
                    .then(posts => {
                        const categorySelect = document.getElementById('category-filter');
                        const selected = categorySelect.value;
                        const categories = [...new Set(posts.map(p => p.tag))];
                        
                        // 카테고리 옵션들을 DOM API로 생성
                        categorySelect.replaceChildren();
                        
                        const allOption = document.createElement('option');
                        allOption.value = 'all';
                        allOption.textContent = 'All Categories';
                        categorySelect.appendChild(allOption);
                        
                        categories.forEach(tag => {
                            const option = document.createElement('option');
                            option.value = tag;
                            option.textContent = tag;
                            if (tag === selected) {
                                option.selected = true;
                            }
                            categorySelect.appendChild(option);
                        });
        
                        const postList = document.getElementById('post-list');
                        postList.replaceChildren();
                        posts.filter(post => selected === 'all' || post.tag === selected).forEach(post => {
                            const postCard = document.createElement('div');
                            postCard.className = 'post-card';
                            
                            // Info 섹션 생성
                            const infoDiv = document.createElement('div');
                            infoDiv.className = 'info';
                            
                            const idDiv = document.createElement('div');
                            const idStrong = document.createElement('strong');
                            idStrong.textContent = 'ID:';
                            idDiv.appendChild(idStrong);
                            idDiv.append(' ' + post.slug);
                            
                            const titleDiv = document.createElement('div');
                            const titleStrong = document.createElement('strong');
                            titleStrong.textContent = 'Title:';
                            titleDiv.appendChild(titleStrong);
                            titleDiv.append(' ' + post.title);
                            
                            const categoryDiv = document.createElement('div');
                            const categoryStrong = document.createElement('strong');
                            categoryStrong.textContent = 'Category:';
                            categoryDiv.appendChild(categoryStrong);
                            categoryDiv.append(' ' + post.tag);
                            
                            const dateDiv = document.createElement('div');
                            const dateStrong = document.createElement('strong');
                            dateStrong.textContent = 'Date:';
                            dateDiv.appendChild(dateStrong);
                            dateDiv.append(' ' + post.cdate);
                            
                            infoDiv.appendChild(idDiv);
                            infoDiv.appendChild(titleDiv);
                            infoDiv.appendChild(categoryDiv);
                            infoDiv.appendChild(dateDiv);
                            
                            // Actions 섹션 생성
                            const actionsDiv = document.createElement('div');
                            actionsDiv.className = 'actions';
                            
                            const editButton = document.createElement('button');
                            editButton.className = 'edit';
                            editButton.textContent = 'Edit';
                            editButton.onclick = () => editPost(post.slug);
                            
                            const deleteButton = document.createElement('button');
                            deleteButton.className = 'delete';
                            deleteButton.textContent = 'Delete';
                            deleteButton.onclick = () => deletePost(post.slug);
                            
                            actionsDiv.appendChild(editButton);
                            actionsDiv.appendChild(deleteButton);
                            
                            postCard.appendChild(infoDiv);
                            postCard.appendChild(actionsDiv);
                            postList.appendChild(postCard);
                        });
                    });
            }
        
            const categorySelect = document.getElementById('category-filter');
            categorySelect.onchange = loadPosts;
        
            function editPost(id) {
                location.href = '/admin/post/edit?id=' + id;
            }
        
            function deletePost(id) {
                if (!confirm("Are you sure you want to delete this post?")) return;
                fetch('/api/admin/post/delete/' + id, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ token: adminToken })
                }).then(res => {
                    if (res.ok) loadPosts();
                    else alert("Failed to delete post.");
                });
            }
        
            document.addEventListener('DOMContentLoaded', () => initializeAdminPage(loadPosts));
        </script>
    </body>
</html>