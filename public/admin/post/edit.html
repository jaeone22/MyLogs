<!DOCTYPE html>
<html lang="{{ML_TRANS_LANG}}">
<head>
	<meta charset="UTF-8">
	<title>{{ML_BLOG_NAME}} - Admin</title>
	<style>
		* {
			box-sizing: border-box;
		}

		html, body {
			height: 100%;
		}

		body {
			background-color: #121212;
			color: #e0e0e0;
			font-family: Arial, sans-serif;
			margin: 0;
			padding: 0;
			overflow-x: hidden;
			height: 100%;
			transition: background-color 0.3s ease;
		}

		.layout-container {
			display: flex;
			flex-direction: column;
			min-height: 100vh;
			max-width: 900px;
			margin: 0 auto;
			width: 100%;
		}

		/* Ìó§Îçî */
		header {
			top: 0;
			bottom: auto;
			display: flex;
			justify-content: space-between;
			align-items: center;
			background-color: rgba(40, 40, 40, 0.7);
			backdrop-filter: blur(8px);
			-webkit-backdrop-filter: blur(8px);
			color: white;
			padding: 10px 20px;
			position: fixed;
			width: 100%;
			left: 0;
			z-index: 10;
			border-bottom: 1px solid rgba(255, 255, 255, 0.1);
			box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
			overflow: hidden;
		}

		/* Ìë∏ÌÑ∞ */
		footer {
			width: 100%;
			max-width: 900px;
			margin: 0 auto;
			text-align: center;
			color: white;
			padding: 10px;
			border: none;
			transition: opacity 0.5s ease;
		}

		/* Î©îÏù∏ Ïª®ÌÖêÏ∏† */
		main {
			padding: 60px 0px 80px;
			margin-top: 60px;
			margin-bottom: 40px;
			flex: 1;
			font-size: 1.2rem;
			line-height: 1.75;
			word-spacing: 0.05em;
		}
		/* Î°úÍ≥† */
		#logo {
			font-weight: bold;
			text-decoration: none;
			color: inherit;
			padding: 6px 12px;
			border-radius: 25px;
			transition: background-color 0.2s;
			cursor: pointer;
		}
		#logo:hover {
			background-color: rgba(255, 255, 255, 0.1);
		}

		/* Í∏Ä Ï†úÎ™© */
		#title {
			font-size: 2rem;
			font-weight: bold;
			margin-bottom: 20px;
		}

		/* Í∏Ä ÎÇ¥Ïö© */
		#body {
			white-space: pre-wrap;
			font-size: 1.2rem;
			line-height: 1.75;
			padding-top: 10px;
		}
		#body p {
			margin-top: 0px;
			margin-bottom: 0px;
			transition: all 0.2s ease;
		}
		#body p:hover {
			background-color: rgba(255, 255, 155, 0.05);
			border-radius: 10px;
			padding: 5px 10px;
			margin: -5px -10px;
			transform: scale(1.02);
		}
		@media (max-width: 768px) {
			#body p:hover {
				background-color: transparent;
				padding: 0;
				margin: 0;
				transform: none;
			}
		}

		/* ÌéòÏù¥ÏßÄ Í∞ïÏ°∞ Î™®ÎìúÏùº Îïå */
		body.hovering header,
		body.hovering footer {
			opacity: 0.1;
		}
		body.hovering {
			background-color: #0a0a0a;
			cursor: none;
		}
		@media (pointer: fine) {
			body.hovering {
				cursor: none;
			}
		}

		/* Í∞ÄÏÉÅ Ïª§ÏÑú Ïä§ÌÉÄÏùº */
		#fake-cursor {
			position: fixed;
			width: 18px;
			height: 18px;
			border-radius: 50%;
			background-color: rgba(255, 255, 255, 0.3);
			pointer-events: none;
			transform: translate(-50%, -50%);
			z-index: 9999;
		}
	</style>
</head>
<body>
	<div class="layout-container">
	<!-- Î∏îÎ°úÍ∑∏ Ï†ïÎ≥¥ -->
    <header>
        <div style="display: flex; align-items: center; gap: 4px;">
            <a href="/" id="logo">{{ML_BLOG_NAME}}</a>
            <a href="/admin" id="logo" style="color: dodgerblue;">Admin</a>
        </div>
    </header>

	<!-- Î©îÏù∏ Ïª®ÌÖêÏ∏† -->
	<main>
		<div style="background-color: rgba(40, 40, 40, 0.7); padding: 30px; border-radius: 25px; box-shadow: 0 2px 12px rgba(0,0,0,0.07);">
			<input id="title" placeholder="Title" autocomplete="off" style="all: unset; display: block; font-size: 2rem; font-weight: bold; margin-bottom: 20px; width: 100%;" />
			<input id="tag" placeholder="Category" autocomplete="off" style="all: unset; display: block; font-size: 1rem; opacity: 0.7; margin-bottom: 20px; width: 100%;" />
			<textarea id="content" placeholder="Write the contents with MLmark..." style="all: unset; display: block; font-size: 1.2rem; line-height: 1.75; width: 100%; resize: vertical;"></textarea>
		</div>
	</main>
	</div> <!-- layout-container Ï¢ÖÎ£å -->

	<footer></footer>

	<script>
	let adminPassword = '';
	let id = new URLSearchParams(location.search).get('id');

	async function sha512(text) {
		const encoder = new TextEncoder();
		const data = encoder.encode(text);
		const hashBuffer = await crypto.subtle.digest('SHA-512', data);
		const hashArray = Array.from(new Uint8Array(hashBuffer));
		return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
	}

	async function init() {
        adminPassword = prompt("üîê MyLogs Admin Password");
        if (!adminPassword) {
            alert("‚ùå Authenticate Failure");
            history.back();
            return;
        }

		const now = Math.floor(Date.now() / 1000);
		const token = await sha512(adminPassword + (now - 1));

		const res = await fetch('/api/admin/verify', {
			method: 'POST',
			headers: { 'Content-Type': 'application/json' },
			body: JSON.stringify({ token })
		});
		if (!res.ok) {
            alert("‚ùå Authenticate Failure");
            history.back();
            return;
		}

		loadPost();
		insertSaveButton();
	}

	async function loadPost() {
		const res = await fetch('/api/user/post/get?id=' + id);
		if (!res.ok) {
			document.body.innerHTML = "<h2 style='color:crimson;'>Failed to load post.</h2>";
			return;
		}
		const text = await res.text();

		const metaMatch = text.match(/<ml-metadata>([\s\S]*?)<\/ml-metadata>/);
		const meta = metaMatch ? metaMatch[1] : '';
		const body = text.replace(/<ml-metadata>[\s\S]*?<\/ml-metadata>/, '').trim();

		const title = meta.match(/<ml-title>(.*?)<\/ml-title>/)?.[1] || '';
		const tag = meta.match(/<ml-tag>(.*?)<\/ml-tag>/)?.[1] || '';

		document.getElementById('title').value = title;
		document.getElementById('tag').value = tag;
		document.getElementById('content').value = body;
	}

	async function submitEdit() {
		const title = document.getElementById('title').value.trim();
		const tag = document.getElementById('tag').value.trim();
		const body = document.getElementById('content').value.trim();

		if (!title || !tag || !body) {
			alert('Please fill all fields.');
			return;
		}

		const now = Math.floor(Date.now() / 1000);
		const token = await sha512(adminPassword + (now - 1));

		const payload = {
			title,
			tag,
			body,
			token
		};

		const res = await fetch('/api/admin/post/edit/' + id, {
			method: 'POST',
			headers: { 'Content-Type': 'application/json' },
			body: JSON.stringify(payload)
		});

		if (res.ok) {
			alert('Post updated!');
			location.href = '/admin/post';
		} else {
			alert('Failed to update post.');
		}
	}

	function insertSaveButton() {
		const saveButton = document.createElement('button');
		saveButton.textContent = 'Save';
		saveButton.style.cssText = 'margin-top: 20px; float: right; padding: 8px 16px; font-weight: bold; border-radius: 25px; background-color: dodgerblue; color: white; border: none; cursor: pointer;';
		saveButton.onclick = submitEdit;

		const main = document.querySelector('main');
		main.appendChild(saveButton);
	}
    </script>

    <script>
	// Í∞ïÏ°∞ ÎßàÏö∞Ïä§ Ïª§ÏÑú ÌÜ†Í∏Ä
	document.addEventListener('DOMContentLoaded', function () {
		const box = document.querySelector('main > div');
		box.addEventListener('mouseenter', () => {
			document.body.classList.add('hovering');
			if (!window.fakeCursor) {
				const cursor = document.createElement('div');
				cursor.id = 'fake-cursor';
				cursor.style.willChange = 'transform';
				document.body.appendChild(cursor);
				window.fakeCursor = cursor;
			}
		});
		box.addEventListener('mouseleave', () => {
			document.body.classList.remove('hovering');
			if (window.fakeCursor) {
				window.fakeCursor.remove();
				window.fakeCursor = null;
			}
		});
	});

	// Í∞ïÏ°∞ ÎßàÏö∞Ïä§ Ïª§ÏÑú Ïù¥Îèô
	document.addEventListener('mousemove', function (e) {
		if (window.fakeCursor && document.body.classList.contains('hovering')) {
			window.requestAnimationFrame(() => {
				window.fakeCursor.style.left = `${e.clientX}px`;
				window.fakeCursor.style.top = `${e.clientY}px`;
			});
		}
	});

	init();
	</script>
</body>
</html>